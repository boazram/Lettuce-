<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pre-Income Ticket Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'DM Sans', 'Segoe UI', system-ui, sans-serif; background: #F8F9FB; color: #1A202C; }
button { font-family: inherit; cursor: pointer; }
.wrap { max-width: 1100px; margin: 0 auto; padding: 0 32px; }
.header { background: #fff; border-bottom: 1px solid #E2E8F0; padding: 28px 0 20px; }
.badge { font-size: 12px; color: #A0AEC0; background: #F8F9FB; padding: 2px 8px; border-radius: 4px; border: 1px solid #E2E8F0; }
.header h1 { font-size: 22px; font-weight: 700; margin: 8px 0 4px; }
.header p { color: #4A5568; font-size: 13px; }
.nav { background: #fff; border-bottom: 1px solid #E2E8F0; position: sticky; top: 0; z-index: 50; }
.nav-inner { display: flex; gap: 0; overflow-x: auto; }
.nav button { background: none; border: none; padding: 12px 18px; color: #A0AEC0; font-size: 13px; font-weight: 500; border-bottom: 2px solid transparent; white-space: nowrap; }
.nav button.active { color: #1A202C; font-weight: 700; border-bottom-color: #059669; }
.content { padding: 28px 0 60px; }
.card { background: #fff; border: 1px solid #E2E8F0; border-radius: 12px; padding: 24px; position: relative; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.04); margin-bottom: 16px; }
.bar { position: absolute; top: 0; left: 0; right: 0; height: 3px; opacity: 0.6; }
.kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(155px, 1fr)); gap: 12px; margin-bottom: 28px; }
.kpi .label { font-size: 11px; color: #A0AEC0; text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 6px; }
.kpi .value { font-size: 28px; font-weight: 700; line-height: 1.1; }
.kpi .sub { font-size: 12px; color: #A0AEC0; margin-top: 4px; }
.shdr { margin-bottom: 20px; }
.shdr .top { display: flex; align-items: center; gap: 12px; }
.shdr .num { color: #fff; font-weight: 800; font-size: 12px; width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
.shdr h2 { font-size: 20px; font-weight: 700; }
.shdr .sub { color: #4A5568; font-size: 13px; margin: 6px 0 0 40px; line-height: 1.4; }
.insight { border-radius: 8px; padding: 10px 14px; margin-top: 12px; display: flex; gap: 8px; font-size: 13px; line-height: 1.5; color: #4A5568; }
.insight.info { background: #EFF6FF; border: 1px solid rgba(37,99,235,0.2); }
.insight.success { background: #ECFDF5; border: 1px solid rgba(5,150,105,0.2); }
.insight.warning { background: #FFFBEB; border: 1px solid rgba(217,119,6,0.2); }
.insight.danger { background: #FEF2F2; border: 1px solid rgba(220,38,38,0.2); }
.insight strong { color: #1A202C; }
.cbox { position: relative; margin: 8px 0; }
.section { display: none; }
.section.active { display: block; }
.split-bar { height: 7px; background: #E2E8F0; border-radius: 3px; overflow: hidden; display: flex; }
.split-bar .g { background: #059669; }
.split-bar .r { background: #DC2626; }
.tbl { width: 100%; border-collapse: collapse; }
.tbl th { font-size: 10px; color: #A0AEC0; text-transform: uppercase; letter-spacing: 0.8px; text-align: left; padding: 0 0 6px; border-bottom: 1px solid #E2E8F0; }
.tbl th.rt { text-align: right; }
.tbl td { font-size: 12px; padding: 5px 0; color: #1A202C; }
.tbl td.rt { text-align: right; font-weight: 600; }
.tbl td.cv { color: #059669; }
.tbl td.nv { color: #DC2626; }
.acc { margin-bottom: 12px; padding: 0 !important; }
.acc-hdr { padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
.acc-hdr .left { display: flex; align-items: center; gap: 12px; }
.acc-hdr .arrow { font-size: 14px; color: #A0AEC0; transition: transform 0.2s; display: inline-block; }
.acc-hdr .arrow.open { transform: rotate(90deg); }
.acc-hdr .cat-t { font-size: 15px; font-weight: 700; }
.acc-hdr .cat-s { font-size: 12px; color: #A0AEC0; margin-top: 2px; }
.acc-hdr .right { display: flex; gap: 16px; align-items: center; }
.acc-hdr .counts span { font-size: 14px; font-weight: 700; }
.acc-body { border-top: 1px solid #E2E8F0; padding: 12px 20px 16px; display: none; }
.ent-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
.ent-card .title { font-size: 14px; font-weight: 700; margin-bottom: 16px; }
.ent-card .cols { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.ent-card .gl { font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; }
.ent-card .pct { font-size: 32px; font-weight: 800; line-height: 1.1; }
.ent-card .det { font-size: 11px; color: #A0AEC0; margin-top: 2px; }
.ent-card .mult { margin-top: 12px; font-size: 12px; color: #4A5568; text-align: center; background: #F8F9FB; border-radius: 6px; padding: 4px 8px; }
.ent-btns { display: flex; gap: 8px; margin-bottom: 16px; }
.ent-btns button { background: #fff; border: 1px solid #E2E8F0; border-radius: 8px; padding: 8px 16px; font-size: 13px; font-weight: 500; color: #A0AEC0; }
.ent-btns button.active { background: #EFF6FF; border-color: #2563EB; color: #2563EB; font-weight: 700; }
.ent-detail { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.ins-card { margin-bottom: 16px; }
.ins-card .hdr { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.ins-card .n { color: #fff; font-weight: 800; font-size: 11px; width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
.ins-card h3 { font-size: 16px; font-weight: 700; }
.ins-card .findings { margin-left: 34px; }
.ins-card .finding { display: flex; gap: 8px; margin-bottom: 6px; font-size: 13px; color: #4A5568; line-height: 1.5; }
.ins-card .abox { border-radius: 8px; padding: 8px 12px; margin-top: 8px; }
.ins-card .alabel { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; }
.ins-card .atext { font-size: 13px; margin-top: 4px; line-height: 1.5; color: #1A202C; }
</style>
</head>
<body>

<div class="header"><div class="wrap">
  <span class="badge">SUPPORT ANALYTICS</span>
  <h1>Pre-Income Ticket Analysis</h1>
  <p>1,379 support tickets from 785 companies · Jan–Oct 2025 · Converted vs. Never-Converted</p>
</div></div>

<div class="nav"><div class="wrap nav-inner" id="nav"></div></div>
<div class="wrap content" id="content"></div>

<script>
const CV='#059669', NV='#DC2626', AC='#2563EB', WN='#D97706', PU='#7C3AED', OR='#EA580C';
const tabs=[{id:'overview',label:'Overview'},{id:'product',label:'Product Areas'},{id:'categories',label:'Ticket Types'},{id:'business',label:'Business Categories'},{id:'entity',label:'Entity Types'},{id:'timeline',label:'Timeline'},{id:'insights',label:'Key Insights'}];
let active='overview', charts={};

function dc(){Object.values(charts).forEach(c=>c.destroy());charts={};}

function mc(id,cfg){
  const el=document.getElementById(id);
  if(!el)return;
  charts[id]=new Chart(el,cfg);
}

function bd(h){
  return{responsive:true,maintainAspectRatio:false,indexAxis:h?'y':'x',
    plugins:{legend:{labels:{font:{family:'DM Sans',size:12},usePointStyle:true,pointStyle:'circle'}}},
    scales:{x:{grid:{color:'#E2E8F020'},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}},y:{grid:{color:'#E2E8F020'},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}}}
  };
}

function ins(type,html){
  const c={info:AC,success:CV,warning:WN,danger:NV};
  return '<div class="insight '+type+'"><span style="color:'+c[type]+';flex-shrink:0">◆</span><span>'+html+'</span></div>';
}

function kpi(label,value,sub,color){
  return '<div class="card kpi"><div class="bar" style="background:'+color+'"></div><div class="label">'+label+'</div><div class="value" style="color:'+color+'">'+value+'</div><div class="sub">'+sub+'</div></div>';
}

function shdr(num,title,sub,color){
  return '<div class="shdr"><div class="top"><span class="num" style="background:'+(color||CV)+'">'+num+'</span><h2>'+title+'</h2></div>'+(sub?'<p class="sub">'+sub+'</p>':'')+'</div>';
}

function renderNav(){
  document.getElementById('nav').innerHTML=tabs.map(t=>'<button class="'+(t.id===active?'active':'')+'" onclick="sw(\''+t.id+'\')">'+t.label+'</button>').join('');
}

function sw(id){active=id;renderNav();dc();document.getElementById('content').innerHTML=R[id]();IC(id);}

const R={};

R.overview=function(){
  return '<div class="kpi-grid">'+
    kpi('Total Tickets','1,379','Pre-income, Jan–Oct 2025',AC)+
    kpi('Companies','785','With matched tickets',AC)+
    kpi('Converted','323','41% of companies',CV)+
    kpi('Never Converted','462','59% of companies',NV)+
    kpi('Tix / Converted Co.','2.0','avg pre-income tickets',CV)+
    kpi('Tix / Never Co.','1.6','avg pre-income tickets',NV)+
  '</div>'+
  shdr('A','Monthly Ticket Volume','Converted vs. never-converted companies, stacked by month',CV)+
  '<div class="card"><div class="bar" style="background:'+AC+'"></div><div class="cbox" style="height:300px"><canvas id="ch-monthly"></canvas></div>'+
  ins('warning','Never-converted tickets trend upward from Aug→Oct while converted tickets decline — suggesting newer signups are converting at lower rates, or recent cohorts face more friction.')+
  '</div>';
};

R.product=function(){
  return shdr('1','Top 15 Pre-Income Issues (All Users)','Most common specific product areas users contact support about before reaching income',AC)+
  '<div class="card"><div class="bar" style="background:'+AC+'"></div><div class="cbox" style="height:460px"><canvas id="ch-top-issues"></canvas></div>'+
  ins('success','<strong>Incorporation & Formation</strong> is the #1 issue (143 tickets) and skews converted (57%).')+
  ins('danger','<strong>Cancellation</strong> is #3 overall (84 tickets) and 92% never-converted. <strong>Account Setup</strong> is #2 (98 tickets) and 57% never-converted.')+
  ins('info','<strong>Financial questions</strong> (Banking, Invoicing, Taxes, Payroll) collectively total 191 tickets and skew heavily converted (72%).')+
  '</div>'+
  '<div style="margin-top:28px">'+shdr('2','Category Breakdown','High-level ticket categories',CV)+
  '<div class="card"><div class="bar" style="background:'+CV+'"></div><div class="cbox" style="height:340px"><canvas id="ch-cat-summary"></canvas></div></div></div>'+
  '<div style="margin-top:28px">'+shdr('3','Subcategory Deep Dive','Expand each category to see the specific product areas driving tickets',PU)+
  buildAccordions()+
  ins('success','<strong>Notices & Documents</strong> skews 81% converted (51 of 63). These users are deep in the formation process.')+
  ins('danger','Within <strong>Account & Subscription</strong>, cancellations (84) nearly match account setup (92). The pipeline is: setup confusion → billing questions → cancellation.')+
  ins('info','<strong>Financial Mgmt</strong> is the most converted-skewed category (72%). <strong>Invoicing & Payments</strong> (82% conv) and <strong>Banking & Cards</strong> (70% conv) indicate users actively moving money through Lettuce.')+
  '</div>';
};

function buildAccordions(){
  const cats=[
    {cat:'Biz Formation & Compliance',cv:205,nv:157,subs:[{s:'Incorporation & Formation',c:81,n:59},{s:'Additional Info Needed',c:43,n:27},{s:'Notices & Documents',c:51,n:12},{s:'Existing LLC',c:15,n:24},{s:'Existing S-Corp',c:2,n:17}]},
    {cat:'Account & Subscription Mgmt',cv:75,nv:195,subs:[{s:'Account Setup & Config',c:36,n:56},{s:'Cancellation',c:7,n:77},{s:'Billing, Pricing & Discounts',c:23,n:30},{s:'Unsubscribe',c:0,n:8}]},
    {cat:'Financial Mgmt & Reporting',cv:180,nv:71,subs:[{s:'Banking & Cards',c:43,n:18},{s:'Invoicing & Payments',c:47,n:10},{s:'Taxes',c:29,n:17},{s:'Accounting & Transactions',c:26,n:11},{s:'Payroll & Salary',c:19,n:7},{s:'Retirement & Benefits',c:3,n:2}]},
    {cat:'Engagement & Feedback',cv:46,nv:46,subs:[{s:'Meeting/Call Request',c:20,n:31},{s:'Status Update Request',c:18,n:6},{s:'Product Feedback',c:6,n:4}]},
    {cat:'Technical Support',cv:15,nv:18,subs:[{s:'System Issue',c:10,n:10},{s:'User Error',c:2,n:3},{s:'Integration & Compatibility',c:2,n:1}]}
  ];
  return cats.map((cat,i)=>{
    const t=cat.cv+cat.nv, p=Math.round(cat.cv/t*100), color=p>=50?CV:NV;
    const rows=cat.subs.map(s=>{const st=s.c+s.n,sp=Math.round(s.c/st*100);return '<tr><td>'+s.s+'</td><td class="rt cv">'+s.c+'</td><td class="rt nv">'+s.n+'</td><td class="rt">'+st+'</td><td><div class="split-bar"><div class="g" style="width:'+sp+'%"></div><div class="r" style="width:'+(100-sp)+'%"></div></div></td></tr>';}).join('');
    return '<div class="card acc" id="acc-'+i+'"><div class="bar" style="background:'+color+'"></div>'+
      '<div class="acc-hdr" onclick="tacc('+i+')"><div class="left"><span class="arrow" id="ar-'+i+'">▶</span><div><div class="cat-t">'+cat.cat+'</div><div class="cat-s">'+t+' tickets · '+p+'% from converted</div></div></div>'+
      '<div class="right"><div class="counts"><span style="color:'+CV+'">'+cat.cv+'</span><span style="color:#A0AEC0"> / </span><span style="color:'+NV+'">'+cat.nv+'</span></div>'+
      '<div style="width:80px"><div class="split-bar"><div class="g" style="width:'+p+'%"></div><div class="r" style="width:'+(100-p)+'%"></div></div></div></div></div>'+
      '<div class="acc-body" id="ab-'+i+'"><table class="tbl"><tr><th>Subcategory</th><th class="rt">Conv.</th><th class="rt">Never</th><th class="rt">Total</th><th style="width:100px">Split</th></tr>'+rows+'</table></div></div>';
  }).join('');
}

R.categories=function(){
  return shdr('1','Ticket Categories: Converted vs. Never','What are people asking about before reaching income?',CV)+
  '<div class="card"><div class="bar" style="background:'+AC+'"></div><div class="cbox" style="height:340px"><canvas id="ch-categories"></canvas></div>'+
  ins('success','<strong>Biz Formation</strong> skews toward converted (205 vs 157), and <strong>Financial Mgmt</strong> is 2.5x higher for converted (180 vs 71).')+
  ins('danger','<strong>Account & Subscription</strong> skews heavily toward never-converted (195 vs 75). This is where cancellations, billing issues, and setup problems live.')+
  '</div>'+
  '<div style="margin-top:28px">'+shdr('2','The Cancellation Signal','Account & Subscription subcategory breakdown',NV)+
  '<div class="card"><div class="bar" style="background:'+NV+'"></div><div class="cbox" style="height:220px"><canvas id="ch-cancel"></canvas></div>'+
  ins('danger','<strong>73 cancellation tickets</strong> from never-converted vs. only <strong>6</strong> from converted — a 12:1 ratio.')+
  '</div></div>'+
  '<div style="margin-top:28px">'+shdr('3','Resolution Time by Category','Median hours to close tickets',PU)+
  '<div class="card"><div class="bar" style="background:'+PU+'"></div><div class="cbox" style="height:300px"><canvas id="ch-resolution"></canvas></div>'+
  ins('info','Converted users consistently wait <strong>longer</strong> for resolution (31.6h vs 21.2h). <strong>Technical Support</strong> for never-converted takes 128h median.')+
  '</div></div>';
};

R.business=function(){
  return shdr('1','Support Ticket Propensity by Business Category','% of companies in each category that filed pre-income tickets (5+ companies each group)',OR)+
  '<div class="card"><div class="bar" style="background:'+WN+'"></div><div class="cbox" style="height:480px"><canvas id="ch-propensity"></canvas></div>'+
  ins('success','Converted companies are <strong>4–10× more likely to file tickets</strong> than never-converted across every category.')+
  ins('info','Never-converted ticket rates are uniformly low (3–15%) regardless of category. <strong>Support engagement is almost exclusively a converted-user behavior.</strong>')+
  '</div>';
};

R.entity=function(){
  const vol=[
    {e:'No Entity (New)',cp:37.3,np:5.3,cn:'196 / 526',nn:'194 / 3,688'},
    {e:'LLC',cp:34.2,np:6.7,cn:'113 / 330',nn:'161 / 2,420'},
    {e:'S-Corp',cp:35.9,np:5.5,cn:'14 / 39',nn:'38 / 689'}
  ];
  const cls=[CV,AC,PU];
  const ecards=vol.map((d,i)=>'<div class="card ent-card"><div class="bar" style="background:'+cls[i]+'"></div>'+
    '<div class="title">'+d.e+'</div><div class="cols">'+
    '<div><div class="gl" style="color:'+CV+'">Converted</div><div class="pct" style="color:'+CV+'">'+d.cp+'%</div><div class="det">'+d.cn+' companies</div></div>'+
    '<div><div class="gl" style="color:'+NV+'">Never Converted</div><div class="pct" style="color:'+NV+'">'+d.np+'%</div><div class="det">'+d.nn+' companies</div></div>'+
    '</div><div class="mult"><strong style="color:'+AC+'">'+(d.cp/d.np).toFixed(1)+'×</strong> more likely to file if converted</div></div>').join('');

  return shdr('1','Ticket Filing Propensity by Entity Type','% of companies in each entity type that filed pre-income support tickets',CV)+
  '<div class="ent-cards">'+ecards+'</div>'+
  ins('success','Across all entity types, <strong>converted companies are 5–7× more likely to file tickets</strong>. The propensity is remarkably consistent (~35% converted vs ~5–7% never).')+
  ins('danger','<strong>S-Corp converted users file at similar rates (35.9%)</strong> but never-converted S-Corps are the only group where those who DO file submit more per company.')+
  '<div style="margin-top:28px">'+shdr('2','Ticket Topics by Entity Type','Select an entity to see category mix and top product areas.',PU)+
  '<div class="ent-btns" id="ebtns"><button class="active" onclick="sent(\'none\')">No Entity (New)</button><button onclick="sent(\'llc\')">LLC</button><button onclick="sent(\'scorp\')">S-Corp</button></div>'+
  '<div class="ent-detail"><div class="card"><div class="bar" style="background:'+AC+'"></div><div style="font-size:13px;font-weight:700;margin-bottom:12px">Category Mix</div><div class="cbox" style="height:220px"><canvas id="ch-emix"></canvas></div></div>'+
  '<div class="card"><div class="bar" style="background:'+PU+'"></div><div style="font-size:13px;font-weight:700;margin-bottom:12px">Top Product Areas</div><div id="etbl"></div></div></div>'+
  ins('success','<strong>NONE (New)</strong>: Top issue is Incorporation (105 tickets, 61% converted). Financial questions skew heavily converted (82-86%).')+
  ins('warning','<strong>LLC</strong>: "Existing LLC" is a unique friction point (27 tickets, 63% never-converted). Cancellation is #4 at 26 tickets (88% never-converted).')+
  ins('danger','<strong>S-Corp</strong>: Cancellation is the #1 issue (14 tickets, 93% never-converted). Cancellation rate is 13.6% of all S-Corp tickets vs 6.4% for NONE/LLC.')+
  '</div>';
};

R.timeline=function(){
  return shdr('1','When Do Converted Users File Tickets?','Distribution of pre-income tickets by months before income received',CV)+
  '<div class="card"><div class="bar" style="background:'+CV+'"></div><div class="cbox" style="height:300px"><canvas id="ch-timing"></canvas></div>'+
  ins('success','<strong>72% of converted-company tickets</strong> (460 of 637) are filed within 1 month of reaching income. The pre-income period is short and intense.')+
  '</div>';
};

R.insights=function(){
  const items=[
    {t:'Financial Management Tickets Are the Strongest Conversion Predictor',c:CV,
     f:['Financial Mgmt tickets are 2.5x more common in converted users (180 vs 71)','Invoicing & Payments: 82% converted (47 of 57). Banking & Cards: 70% converted (43 of 61)','For NONE entity users, financial questions are 85% converted (93 of 110)'],
     a:'Users asking financial questions are at the finish line. Prioritize fast resolution for Invoicing, Banking, and Payroll tickets. Consider proactive financial onboarding for users who haven\'t engaged with these areas yet.'},
    {t:'The Never-Converted Pipeline: Setup → Billing → Cancellation',c:NV,
     f:['Account Setup: 57% never-converted (56 of 98). Billing/Pricing: 56% never-converted (30 of 54). Cancellation: 92% never-converted (77 of 84)','Account & Sub tickets are 72% never-converted for LLC (65 of 90) and 88% for S-Corp (23 of 26)','Meeting/Call Requests skew never-converted (61%, 31 of 51) — users seeking human reassurance before they give up'],
     a:'Intervene early in the Account & Sub pipeline. When a user files a setup or billing ticket, trigger proactive value messaging. When they request a call, treat it as a retention opportunity.'},
    {t:'S-Corp Users Have a Fundamentally Different Ticket Pattern',c:PU,
     f:['S-Corp is the ONLY entity type where never-converted file more tickets per company (2.0) than converted (1.93)','Cancellation is the #1 S-Corp issue (14 tickets, 93% never-converted)','S-Corp cancellation rate is 13.6% of all tickets vs 6.4% for NONE and LLC'],
     a:'S-Corp users need a different support experience. Their tickets indicate confusion about what Lettuce adds. Build S-Corp-specific onboarding that leads with payroll/tax automation value.'},
    {t:'Notices & Documents: Hidden Conversion Signal',c:AC,
     f:['Notices & Documents tickets are 81% converted (51 of 63 in Biz Formation)','Highest conversion skew of any major subcategory','These users are deep in the formation process — a sign of real commitment'],
     a:'Users filing Notices & Documents tickets are almost certainly converting. Ensure fast turnaround and use this signal to identify high-intent users for proactive support.'}
  ];
  return shdr('★','Strategic Insights & Recommendations','Ticket-data-driven findings from 1,379 pre-income tickets across 785 companies',WN)+
  items.map((x,i)=>'<div class="card ins-card"><div class="bar" style="background:'+x.c+'"></div>'+
    '<div class="hdr"><span class="n" style="background:'+x.c+'">'+(i+1)+'</span><h3>'+x.t+'</h3></div>'+
    '<div class="findings">'+x.f.map(f=>'<div class="finding"><span style="color:'+x.c+';font-size:8px;margin-top:5px">●</span><span>'+f+'</span></div>').join('')+
    '<div class="abox" style="background:'+x.c+'10;border:1px solid '+x.c+'25"><div class="alabel" style="color:'+x.c+'">→ Action</div><div class="atext">'+x.a+'</div></div></div></div>').join('');
};

function tacc(i){
  const b=document.getElementById('ab-'+i);
  const a=document.getElementById('ar-'+i);
  const open=b.style.display!=='none';
  b.style.display=open?'none':'block';
  a.classList.toggle('open',!open);
}

const ED={
  none:{cats:[{c:'Biz Formation',cv:138,nv:77},{c:'Account & Sub',cv:47,nv:94},{c:'Financial Mgmt',cv:93,nv:17},{c:'Engagement',cv:35,nv:24},{c:'Misc/Tech',cv:24,nv:14}],
    subs:[{s:'Incorporation & Formation',c:64,n:41},{s:'Account Setup & Config',c:28,n:23},{s:'Additional Info Needed',c:28,n:20},{s:'Cancellation',c:3,n:38},{s:'Notices & Documents',c:34,n:6},{s:'Invoicing & Payments',c:28,n:6},{s:'Billing & Pricing',c:14,n:17},{s:'Banking & Cards',c:24,n:4}]},
  llc:{cats:[{c:'Biz Formation',cv:62,nv:53},{c:'Account & Sub',cv:25,nv:65},{c:'Financial Mgmt',cv:79,nv:28},{c:'Engagement',cv:9,nv:12},{c:'Misc/Tech',cv:14,nv:17}],
    subs:[{s:'Incorporation & Formation',c:18,n:17},{s:'Account Setup & Config',c:13,n:19},{s:'Existing LLC',c:10,n:17},{s:'Cancellation',c:3,n:23},{s:'Banking & Cards',c:17,n:9},{s:'Additional Info Needed',c:15,n:7},{s:'Taxes',c:15,n:7},{s:'Invoicing & Payments',c:17,n:3}]},
  scorp:{cats:[{c:'Account & Sub',cv:3,nv:23},{c:'Biz Formation',cv:5,nv:12},{c:'Financial Mgmt',cv:8,nv:7},{c:'Engagement',cv:2,nv:4},{c:'Misc/Tech',cv:3,nv:3}],
    subs:[{s:'Cancellation',c:1,n:13},{s:'Existing S-Corp',c:2,n:7},{s:'Account Setup & Config',c:1,n:5},{s:'Accounting & Transactions',c:4,n:2},{s:'Meeting/Call Request',c:1,n:4},{s:'Banking & Cards',c:2,n:2},{s:'Billing & Pricing',c:1,n:2},{s:'System Issue',c:1,n:2}]}
};
let curEnt='none';

function sent(k){
  curEnt=k;
  document.querySelectorAll('.ent-btns button').forEach((b,i)=>b.classList.toggle('active',['none','llc','scorp'][i]===k));
  if(charts['ch-emix'])charts['ch-emix'].destroy();
  iec();ret();
}

function iec(){
  const d=ED[curEnt];
  mc('ch-emix',{type:'bar',data:{labels:d.cats.map(c=>c.c),datasets:[{label:'Converted',data:d.cats.map(c=>c.cv),backgroundColor:CV},{label:'Never Converted',data:d.cats.map(c=>c.nv),backgroundColor:NV}]},
    options:{...bd(true),plugins:{legend:{display:false}},scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,grid:{display:false},ticks:{font:{family:'DM Sans',size:10},color:'#4A5568'}}}}});
}

function ret(){
  const d=ED[curEnt];
  const rows=d.subs.map(s=>{const t=s.c+s.n,p=Math.round(s.c/t*100);return '<tr><td>'+s.s+'</td><td class="rt cv">'+s.c+'</td><td class="rt nv">'+s.n+'</td><td><div class="split-bar"><div class="g" style="width:'+p+'%"></div><div class="r" style="width:'+(100-p)+'%"></div></div></td></tr>';}).join('');
  document.getElementById('etbl').innerHTML='<table class="tbl"><tr><th>Issue</th><th class="rt" style="color:'+CV+'">Conv</th><th class="rt" style="color:'+NV+'">Never</th><th style="width:80px">Split</th></tr>'+rows+'</table>';
}

function IC(s){
  if(s==='overview'){
    mc('ch-monthly',{type:'bar',data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct'],datasets:[{label:'Converted',data:[78,107,78,66,51,59,70,49,52,27],backgroundColor:CV},{label:'Never Converted',data:[73,76,95,71,40,62,75,87,95,68],backgroundColor:NV}]},
      options:{...bd(false),scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,grid:{color:'#E2E8F020'}}}}});
  }
  if(s==='product'){
    const iss=['Incorporation & Formation','Account Setup & Config','Cancellation','Additional Info Needed','Notices & Documents','Banking & Cards','Invoicing & Payments','Billing, Pricing & Discounts','Meeting/Call Request','Taxes','Accounting & Transactions','Existing LLC','Status Update Request','Payroll & Salary','System Issue'];
    mc('ch-top-issues',{type:'bar',data:{labels:iss,datasets:[{label:'Converted',data:[82,42,7,44,53,43,47,24,20,29,26,15,21,19,10],backgroundColor:CV},{label:'Never Converted',data:[61,56,77,27,12,18,10,30,31,18,13,24,6,7,10],backgroundColor:NV}]},
      options:{...bd(true),scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,grid:{display:false},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}}}}});
    mc('ch-cat-summary',{type:'bar',data:{labels:['Biz Formation & Compliance','Account & Subscription Mgmt','Financial Mgmt & Reporting','Engagement & Feedback','Misc. Inquiry','Technical Support'],datasets:[{label:'Converted',data:[205,75,180,46,26,15],backgroundColor:CV},{label:'Never Converted',data:[157,195,71,46,38,18],backgroundColor:NV}]},
      options:{...bd(true),scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,grid:{display:false},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}}}}});
  }
  if(s==='categories'){
    mc('ch-categories',{type:'bar',data:{labels:['Biz Formation & Compliance','Account & Subscription Mgmt','Financial Mgmt & Reporting','Engagement & Feedback','Misc. Inquiry','Technical Support'],datasets:[{label:'Converted',data:[205,75,180,46,26,15],backgroundColor:CV},{label:'Never Converted',data:[157,195,71,46,38,18],backgroundColor:NV}]},
      options:{...bd(true),scales:{x:{grid:{display:false}},y:{grid:{display:false},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}}}}});
    mc('ch-cancel',{type:'bar',data:{labels:['Cancellation','Account Setup','Billing/Pricing'],datasets:[{label:'Converted',data:[6,31,18],backgroundColor:CV},{label:'Never Converted',data:[73,51,25],backgroundColor:NV}]},options:bd(false)});
    mc('ch-resolution',{type:'bar',data:{labels:['Account & Sub','Biz Formation','Engagement','Financial Mgmt','Misc. Inquiry','Tech Support'],datasets:[{label:'Converted (median hrs)',data:[43.7,44.8,28.2,39.2,29.0,24.8],backgroundColor:CV},{label:'Never Converted (median hrs)',data:[29.3,39.2,16.0,27.2,4.9,128.4],backgroundColor:NV}]},options:bd(false)});
  }
  if(s==='business'){
    mc('ch-propensity',{type:'bar',data:{labels:['Insurance (n=78)','Content Creation (n=119)','Therapy (n=239)','Real Estate (n=585)','Personal Care (n=183)','Healthcare (n=389)','Biz, Finance (n=269)','Marketing & Sales (n=392)','Engineering & IT (n=457)','Consulting (n=1,406)','Design & Creative (n=301)','Coaching (n=258)','Arts & Ent. (n=323)'],
      datasets:[{label:'Converted %',data:[63.6,58.3,51.6,47.4,43.8,41.5,40.7,38.3,36.4,35.9,34.1,22.7,20.8],backgroundColor:CV},{label:'Never Converted %',data:[10.4,15.0,6.2,4.0,4.8,7.4,5.8,7.8,9.2,9.3,7.8,3.4,5.4],backgroundColor:NV}]},
      options:{...bd(true),scales:{x:{max:70,ticks:{callback:function(v){return v+'%'},font:{family:'DM Sans',size:11},color:'#4A5568'},grid:{display:false}},y:{grid:{display:false},ticks:{font:{family:'DM Sans',size:11},color:'#4A5568'}}}}});
  }
  if(s==='entity'){iec();ret();}
  if(s==='timeline'){
    mc('ch-timing',{type:'bar',data:{labels:['Same month','1mo before','2mo before','3mo before','4mo before','5mo before','6mo before'],datasets:[{label:'Tickets',data:[263,197,80,36,21,10,5],backgroundColor:[CV,AC,'#94A3B8','#94A3B8','#94A3B8','#94A3B8','#94A3B8'],borderRadius:6}]},
      options:{...bd(false),plugins:{legend:{display:false}}}});
  }
}

renderNav();
sw('overview');
</script>
</body>
</html>
